{% extends "base/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-5">
  <div class="row d-flex justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">User Profile</h3>
        </div>
        
        <div class="card-body">
          <div class="row">
            <!-- Profile Picture Column -->
            <div class="col-md-4 text-center">
              <div class="profile-img-container mb-4">
                <img src="{{ user_profile.get_path }}" 
                     alt="Profile Picture" 
                     class="rounded-circle img-thumbnail shadow"
                     width="180" 
                     height="180">
                <div class="mt-3">
                  <span class="badge bg-{{ user_profile.user_type|lower }} text-white p-2">
                    {{ user_profile.user_type }}
                  </span>
                </div>
              </div>
            </div>
            
            <!-- User Details Column -->
            <div class="col-md-8">
              <div class="profile-details">
                <h2 class="mb-3">{{ user_profile.get_full_name }}</h2>
                
                <div class="mb-4">
                  <h5 class="text-muted">@{{ user_profile.username }}</h5>
                  <p class="text-muted mb-1">
                    <i class="fas fa-envelope me-2"></i> {{ user_profile.email }}
                  </p>
                  {% if user_profile.phone_number %}
                  <p class="text-muted mb-1">
                    <i class="fas fa-phone me-2"></i> {{ user_profile.phone_number }}
                  </p>
                  {% endif %}
                  {% if user_profile.address %}
                  <p class="text-muted">
                    <i class="fas fa-map-marker-alt me-2"></i> {{ user_profile.address }}
                  </p>
                  {% endif %}
                </div>
                
                <!-- Skills Section -->
                <div class="skills-section mt-4">
                  <h5 class="mb-3">Skills</h5>
                  {% if user_profile.skill.all %}
                    <div class="d-flex flex-wrap gap-2">
                      {% for skill in user_profile.skill.all %}
                        <span class="badge bg-info text-dark p-2 mr-1">
                          <i class="fas fa-check-circle me-1"></i> {{ skill.name }}
                        </span>
                      {% endfor %}
                    </div>
                  {% else %}
                    <p class="text-muted">No skills added yet</p>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer bg-light">
            <div class="d-flex justify-content-end">
                <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                    <i class="fas fa-edit me-1"></i> Edit Profile
                </button>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Edit Profile Modal - Bootstrap 4 Version -->
<div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
      </div>
      <form method="post" enctype="multipart/form-data" action="{% url 'core:update_profile' %}">
        {% csrf_token %}
        <div class="modal-body">
          <div class="row">
            <div class="col-md-4 text-center">
              <div class="mb-3">
                <img id="profilePicturePreview" 
                     src="{{ user_profile.get_path }}" 
                     class="rounded-circle img-thumbnail" 
                     width="150" 
                     height="150"
                     alt="Current Profile Picture">
              </div>
              <div class="mb-3">
                {{ form.profile_picture|as_crispy_field }}
              </div>
            </div>
            <div class="col-md-8">
              <div class="row">
                <div class="col-md-6">
                  {{ form.first_name|as_crispy_field }}
                </div>
                <div class="col-md-6">
                  {{ form.last_name|as_crispy_field }}
                </div>
              </div>
              {{ form.address|as_crispy_field }}
              {{ form.phone_number|as_crispy_field }}
              {{ form.skill|as_crispy_field }}
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Profile picture preview
  document.getElementById('id_profile_picture').addEventListener('change', function(event) {
    const [file] = event.target.files;
    if (file) {
      const preview = document.getElementById('profilePicturePreview');
      preview.src = URL.createObjectURL(file);
      preview.onload = function() {
        URL.revokeObjectURL(preview.src);
      }
    }
  });

</script>

<style>
  .profile-img-container {
    position: relative;
  }
  
  .card {
    border-radius: 15px;
    overflow: hidden;
  }
  
  .img-thumbnail {
    border: 3px solid #dee2e6;
    transition: all 0.3s ease;
  }
  
  .img-thumbnail:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  
  .badge.bg-admin {
    background-color: #6f42c1 !important;
  }
  
  .badge.bg-user {
    background-color: #20c997 !important;
  }
  
  .skills-section {
    background-color: #f8f9fa;
    padding: 1.25rem;
    border-radius: 10px;
  }
    /* Add this to your existing styles */
  .modal-body .form-group {
    margin-bottom: 1rem;
  }
  
  /* Make skill select multiple look better */
  select[multiple] {
    height: auto;
    min-height: 100px;
  }
  
  /* Style for crispy forms */
  .form-control:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
</style>
{% endblock %}